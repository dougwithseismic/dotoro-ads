---
/**
 * Blog Section Component
 *
 * Displays the blog/articles section with a featured article and two
 * smaller article cards. Design matches Figma "Blog Section" node 40083:7195.
 *
 * Layout:
 * - Header with badge, title (with italic accent), and "View All Blogs" button
 * - Featured article card with large image and gradient background (left)
 * - Two smaller article cards stacked vertically (right)
 *
 * @example
 * ```astro
 * <Blog />
 * ```
 */
import { getCollection } from 'astro:content';
import Section from '@/components/sections/Section.astro';
import { DEFAULT_LOCALE, type Locale } from '@/i18n';

export interface Props {
  /** Language/locale for translations */
  lang?: Locale;
  /** Additional CSS classes */
  class?: string;
}

const {
  lang: _lang = DEFAULT_LOCALE,
  class: className = '',
} = Astro.props;

// Fetch articles from content collection
const allArticles = await getCollection('articles', ({ data }) => !data.draft);

// Sort by date (newest first)
const sortedArticles = allArticles.sort(
  (a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime()
);

// Get featured article (or fallback to newest)
const featuredArticle = sortedArticles.find((a) => a.data.featured) || sortedArticles[0];

// Get side articles (exclude featured, take next 2)
const sideArticles = sortedArticles
  .filter((a) => a.slug !== featuredArticle?.slug)
  .slice(0, 2);

// Arrow right icon SVG
const arrowRightIcon = `<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M4.16667 10H15.8333M15.8333 10L10.8333 5M15.8333 10L10.8333 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`;

// Blog/sidebar icon SVG
const blogIcon = `<svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect x="2" y="3" width="14" height="12" rx="2" stroke="currentColor" stroke-width="1.5"/>
  <path d="M6 3V15" stroke="currentColor" stroke-width="1.5"/>
  <path d="M9 7H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
  <path d="M9 10H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
</svg>`;
---

<Section
  id="blog"
  background="white"
  padding="lg"
  class:list={['blog-section', className]}
  aria-labelledby="blog-title"
>
  <div class="blog-content">
    <!-- Header -->
    <div class="blog-header">
      <div class="blog-header-left">
        <!-- Badge -->
        <div class="blog-badge">
          <span class="badge-icon">
            <Fragment set:html={blogIcon} />
          </span>
          <span class="badge-text">Blog</span>
        </div>

        <!-- Title with italic accent -->
        <h2 id="blog-title" class="blog-title">
          <span>AI tips, productivity hacks, </span>
          <em class="blog-title-accent">and ChatFinity Updates</em>
        </h2>
      </div>

      <!-- View All Button -->
      <a href="/articles" class="view-all-button">
        <span>View All Blogs</span>
      </a>
    </div>

    <!-- Articles Grid -->
    <div class="blog-grid">
      <!-- Featured Article Card -->
      {featuredArticle && (
        <article class="featured-card">
          <div class="featured-image-wrapper">
            <img
              src={featuredArticle.data.coverImage || '/images/blog/placeholder.svg'}
              alt=""
              class="featured-image"
              loading="lazy"
            />
          </div>
          <div class="featured-content">
            <div class="featured-text">
              <h3 class="featured-title">{featuredArticle.data.title}</h3>
              <p class="featured-description">{featuredArticle.data.description}</p>
            </div>
            <a href={`/articles/${featuredArticle.slug}`} class="read-more-link">
              <span>Read More</span>
              <Fragment set:html={arrowRightIcon} />
            </a>
          </div>
        </article>
      )}

      <!-- Side Articles -->
      <div class="side-articles">
        {sideArticles.map((article) => (
          <article class="side-card">
            <div class="side-card-content">
              <h3 class="side-card-title">{article.data.title}</h3>
              <p class="side-card-description">{article.data.description}</p>
            </div>
            <a href={`/articles/${article.slug}`} class="read-more-link">
              <span>Read More</span>
              <Fragment set:html={arrowRightIcon} />
            </a>
          </article>
        ))}
      </div>
    </div>
  </div>
</Section>

<style>
  /* ==========================================================================
     BLOG SECTION STYLES
     Matches Figma "Blog Section" node 40083:7195
     ========================================================================== */
  .blog-section {
    position: relative;
    padding-top: 140px;
    padding-bottom: 140px;
  }

  .blog-content {
    display: flex;
    flex-direction: column;
    gap: 56px;
    width: 100%;
  }

  /* ==========================================================================
     BLOG HEADER
     ========================================================================== */
  .blog-header {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    width: 100%;
    min-height: 164px;
  }

  .blog-header-left {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 624px;
  }

  /* ==========================================================================
     BLOG BADGE
     ========================================================================== */
  .blog-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 16px 4px 12px;
    background: white;
    border: 1px solid #e3eaf1;
    border-radius: 32px;
    height: 36px;
    width: fit-content;
  }

  .badge-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 18px;
    color: var(--color-text-grey);
  }

  .badge-icon :global(svg) {
    width: 18px;
    height: 18px;
  }

  .badge-text {
    font-family: var(--font-subheading);
    font-weight: var(--font-weight-medium);
    font-size: 14px;
    line-height: 1.2;
    letter-spacing: 0.14px;
    text-transform: uppercase;
    color: var(--color-text-grey);
  }

  /* ==========================================================================
     BLOG TITLE
     ========================================================================== */
  .blog-title {
    font-family: var(--font-heading);
    font-size: var(--text-h2);
    font-weight: var(--font-weight-medium);
    line-height: var(--line-height-snug);
    letter-spacing: -0.96px;
    color: var(--color-text-black);
    margin: 0;
    text-transform: capitalize;
  }

  .blog-title-accent {
    display: inline;
    font-family: 'Playfair Display', Georgia, serif;
    font-style: italic;
    font-weight: var(--font-weight-regular);
  }

  /* ==========================================================================
     VIEW ALL BUTTON
     ========================================================================== */
  .view-all-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: 16px 24px;
    background: white;
    border: 1px solid #dce5ed;
    border-radius: 14px;
    box-shadow: 0px 0px 0px 1px rgba(225, 228, 234, 0.6);
    text-decoration: none;
    transition: all var(--transition-normal) var(--ease-out);
    flex-shrink: 0;
  }

  .view-all-button span {
    font-family: var(--font-heading);
    font-weight: var(--font-weight-medium);
    font-size: var(--text-body-sm);
    line-height: 1;
    letter-spacing: -0.16px;
    color: #676e80;
  }

  .view-all-button:hover {
    border-color: var(--color-brand);
    box-shadow: 0px 0px 0px 1px var(--color-brand-100);
  }

  .view-all-button:hover span {
    color: var(--color-brand);
  }

  /* ==========================================================================
     BLOG GRID
     ========================================================================== */
  .blog-grid {
    display: flex;
    gap: 24px;
    width: 100%;
  }

  /* ==========================================================================
     FEATURED CARD
     ========================================================================== */
  .featured-card {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 32px;
    padding: 32px;
    padding-bottom: 40px;
    background: linear-gradient(180deg, #f2fbff 0%, #fef7f1 100%);
    border-radius: 40px;
    overflow: hidden;
    min-width: 0;
  }

  .featured-image-wrapper {
    width: 100%;
    height: 320px;
    border-radius: 24px;
    overflow: hidden;
  }

  .featured-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  .featured-content {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .featured-text {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .featured-title {
    font-family: var(--font-heading);
    font-size: var(--text-h4);
    font-weight: var(--font-weight-medium);
    line-height: var(--line-height-snug);
    letter-spacing: -0.64px;
    color: var(--color-text-black);
    margin: 0;
  }

  .featured-description {
    font-family: var(--font-heading);
    font-size: var(--text-body-sm);
    font-weight: var(--font-weight-regular);
    line-height: var(--line-height-relaxed);
    color: var(--color-text-grey);
    margin: 0;
  }

  /* ==========================================================================
     SIDE ARTICLES
     ========================================================================== */
  .side-articles {
    display: flex;
    flex-direction: column;
    gap: 24px;
    width: 600px;
    flex-shrink: 0;
  }

  .side-card {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 32px;
    background: white;
    border: 1px solid #e3eaf1;
    border-radius: 32px;
    overflow: hidden;
  }

  .side-card-content {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .side-card-title {
    font-family: var(--font-heading);
    font-size: 24px;
    font-weight: var(--font-weight-medium);
    line-height: 1.3;
    letter-spacing: -0.24px;
    color: var(--color-text-black);
    margin: 0;
  }

  .side-card-description {
    font-family: var(--font-heading);
    font-size: var(--text-body-sm);
    font-weight: var(--font-weight-regular);
    line-height: var(--line-height-relaxed);
    color: var(--color-text-grey);
    margin: 0;
  }

  /* ==========================================================================
     READ MORE LINK
     ========================================================================== */
  .read-more-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    border-radius: 14px;
    transition: gap var(--transition-normal) var(--ease-out);
  }

  .read-more-link span {
    font-family: var(--font-heading);
    font-weight: var(--font-weight-medium);
    font-size: var(--text-body-sm);
    line-height: 1;
    letter-spacing: -0.16px;
    color: var(--color-brand);
  }

  .read-more-link :global(svg) {
    width: 20px;
    height: 20px;
    color: var(--color-brand);
    transition: transform var(--transition-normal) var(--ease-out);
  }

  .read-more-link:hover {
    gap: 12px;
  }

  .read-more-link:hover :global(svg) {
    transform: translateX(4px);
  }

  /* ==========================================================================
     RESPONSIVE STYLES
     ========================================================================== */
  @media (max-width: 1200px) {
    .blog-section {
      padding-top: 100px;
      padding-bottom: 100px;
    }

    .blog-content {
      gap: 48px;
    }

    .side-articles {
      width: 500px;
    }
  }

  @media (max-width: 1024px) {
    .blog-section {
      padding-top: 80px;
      padding-bottom: 80px;
    }

    .blog-content {
      gap: 40px;
    }

    .blog-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 24px;
      min-height: auto;
    }

    .blog-grid {
      flex-direction: column;
    }

    .side-articles {
      width: 100%;
      flex-direction: row;
    }

    .side-card {
      flex: 1;
    }
  }

  @media (max-width: 768px) {
    .blog-section {
      padding-top: 60px;
      padding-bottom: 60px;
    }

    .blog-content {
      gap: 32px;
    }

    .blog-title {
      font-size: var(--text-h3);
      letter-spacing: -0.8px;
    }

    .blog-grid {
      gap: 20px;
    }

    .featured-card {
      padding: 24px;
      padding-bottom: 32px;
      border-radius: 32px;
      gap: 24px;
    }

    .featured-image-wrapper {
      height: 240px;
      border-radius: 20px;
    }

    .featured-title {
      font-size: 28px;
    }

    .side-articles {
      flex-direction: column;
      gap: 16px;
    }

    .side-card {
      padding: 24px;
      border-radius: 24px;
      gap: 16px;
    }

    .side-card-title {
      font-size: 20px;
    }
  }

  @media (max-width: 480px) {
    .blog-title {
      font-size: var(--text-h4);
      letter-spacing: -0.64px;
    }

    .view-all-button {
      width: 100%;
    }

    .featured-card {
      padding: 20px;
      border-radius: 24px;
    }

    .featured-image-wrapper {
      height: 200px;
      border-radius: 16px;
    }

    .featured-title {
      font-size: 24px;
    }

    .side-card {
      padding: 20px;
    }

    .side-card-title {
      font-size: 18px;
    }

    .side-card-description {
      font-size: 14px;
    }
  }
</style>
